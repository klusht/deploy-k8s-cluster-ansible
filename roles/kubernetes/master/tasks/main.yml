---
- include_role:
    name: hosts_entries

- include_role:
    name:  kubernetes/packages

- include_role:
    name: docker

- name: Open ports
  firewalld:
    port: "{{ item }}/tcp"
    permanent: true
    state: enabled
  with_items:
    - 2379-2380 # etcd server
    - 6443      # kube API
    - 10250     # kube API
    - 10251     # scheduler
    - 10252     # controller manager

- name: Reload firewall
  shell: "firewall-cmd --reload"

- name: Initialize kubeadm
  include_tasks: kubeadm_init.yml

- name: Copy kubeadm init logs to local env for extraction
  fetch:
    src: /tmp/kubeadm_init.log
    dest: generated_resources/kubeadm_init.log
    flat: yes

- name: Copy kubectl admin config
  fetch:
    src: /etc/kubernetes/admin.conf
    dest: generated_resources/config
    flat: yes





